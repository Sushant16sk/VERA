<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
        }

        #container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            background: #e0edff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 40px;
            color: #5b5b5b;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #mic-button:hover {
            background: #c3cfe2;
        }

        #listening {
            display: none;
            margin-top: -20px;
        }

        svg {
            background: #ff5656;
            border-radius: 100px;
        }

        polyline {
            fill: none;
            stroke: whitesmoke;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        #transcript {
            margin-top: 20px;
            font-size: 18px;
        }

        #text-input-container {
            display: none;
            margin-top: 20px;
        }

        #text-input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
        }

        #submit-button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #e0edff;
            border: none;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        #submit-button:hover {
            background: #c3cfe2;
        }

        #image-upload-container {
            display: none;
            margin-top: 20px;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
        }

        #image-upload-label {
            display: none;
            font-size: 16px;
            margin-bottom: 10px;
        }

        #image-upload {
            display: none;
        }

        #select-image-button,
        #upload-image-button {
            display: inline-block;
            margin-right: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #e0edff;
            border: none;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        #select-image-button:hover,
        #upload-image-button:hover {
            background: #c3cfe2;
        }

        #upload-confirmation {
            display: none;
            margin-top: 10px;
            color: green;
        }

        #image-preview {
            display: none;
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            margin-left: auto;
            margin-right: auto;
            border-radius: 10px;
            border: 2px solid #000000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .loader {
            display: none;
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .roundButtons {
            display: flex !important;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 75px;
            height: 75px;
            align-items: center;
            justify-content: center;
        }

        #audioElement {
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }

        #bars {
            display: none;
            justify-content: center;
            align-items: center;
            align-items: flex-end;
            /* Align bars at the bottom */
            height: 100px;
            /* Fixed height */
            overflow: hidden;
            /* Hide overflow to prevent container expansion */
        }

        .bar {
            background: #52467b;
            bottom: 1px;
            height: 3px;
            width: 10px;
            margin: 0px 4px;
            border-radius: 5px;
            animation: sound 0ms -600ms linear infinite alternate;
        }

        @keyframes sound {
            0% {
                opacity: .35;
                height: 3px;
            }

            100% {
                opacity: 1;
                height: 70px;
            }
        }

        .bar:nth-child(1) {
            left: 1px;
            animation-duration: 474ms;
        }

        .bar:nth-child(2) {
            left: 15px;
            animation-duration: 433ms;
        }

        .bar:nth-child(3) {
            left: 29px;
            animation-duration: 407ms;
        }

        .bar:nth-child(4) {
            left: 43px;
            animation-duration: 458ms;
        }

        .bar:nth-child(5) {
            left: 57px;
            animation-duration: 400ms;
        }

        .bar:nth-child(6) {
            left: 71px;
            animation-duration: 427ms;
        }

        .bar:nth-child(7) {
            left: 85px;
            animation-duration: 441ms;
        }

        .bar:nth-child(8) {
            left: 99px;
            animation-duration: 419ms;
        }

        .bar:nth-child(9) {
            left: 113px;
            animation-duration: 487ms;
        }

        .bar:nth-child(10) {
            left: 127px;
            animation-duration: 442ms;
        }

        #fileActionModal {
            display: none;
            /* Hide the modal initially */
        }

        /* File Upload Container */
        #file-upload-container {
            display: none;
        }

        /* File Upload Label */
        #file-upload-label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* File Upload Info */
        .file-upload-info {
            font-size: 14px;
            color: #666;
        }

        /* File Upload Input */
        #file-upload {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            /* Ensure cursor changes to pointer on hover */
        }

        /* Customize file input appearance */
        #file-upload::-webkit-file-upload-button {
            visibility: hidden;
        }

        #file-upload::before {
            content: 'Select File';
            /* Custom text for the button */
            display: inline-block;
            padding: 10px;
            outline: none;
            white-space: nowrap;
            cursor: pointer;
            background-color: #007bff;
            /* Button background color */
            color: #fff;
            /* Button text color */
            border: none;
            border-radius: 4px;
        }

        #file-upload:hover::before {
            background-color: #0056b3;
            /* Darker background color on hover */
        }

        #file-upload:active::before {
            background-color: #004080;
            /* Darker background color when pressed */
        }

        #apply-container {
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .mic-button-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .mic-button1 {
            background-color: #2185d0;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mic-button1 i {
            margin: 0;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 10px rgba(0, 0, 255, 0.8), 0 0 20px rgba(0, 0, 255, 0.8), 0 0 30px rgba(0, 0, 255, 0.8);
            }

            50% {
                box-shadow: 0 0 20px rgba(0, 0, 255, 0.8), 0 0 30px rgba(0, 0, 255, 0.8), 0 0 40px rgba(0, 0, 255, 0.8);
            }

            100% {
                box-shadow: 0 0 10px rgba(0, 0, 255, 0.8), 0 0 20px rgba(0, 0, 255, 0.8), 0 0 30px rgba(0, 0, 255, 0.8);
            }
        }

        .mic-button1.active {
            animation: glow 1s infinite;
        }

        #suggested-commands {
            margin-top: 20px;
            background: #ffffff;
            /* White background to match the container */
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            text-align: left;
            font-size: 16px;
        }

        #suggested-commands p {
            margin: 0 0 10px;
            font-weight: bold;
            color: #333;
        }

        #suggested-commands ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #suggested-commands li {
            margin: 5px 0;
            padding: 10px;
            background: #e0edff;
            /* Light blue background to match the button hover state */
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background 0.3s, box-shadow 0.3s;
        }

        #suggested-commands li:hover {
            background: #c3cfe2;
            /* Slightly darker blue on hover */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>

<body>

    <div id="voiceModal" class="ui mini modal">
        <i class="close icon"></i>
        <div class="header">
            Choose Your Preferred Voice
        </div>
        <div class="content">
            <div class="ui" style="display: flex; justify-content: space-evenly;">
                <button class="ui circular icon button primary rounded roundButtons" id="male">
                    <span>Male</span>
                    <i class="large male icon"></i>
                </button>
                <button class="ui circular icon button teal rounded roundButtons" id="female">
                    <span>Female</span>
                    <i class="large female icon"></i>
                </button>
            </div>
            <div class="ui segment" id="Speechrate">
                <label for="speechRateSlider">Speech Rate:</label>
                <input type="range" class="custom-range" id="speechRateSlider" min="50" max="300" value="150">
                <div class="text-center mt-3">
                    <span id="speechRateValue">150</span>
                </div>
            </div>
        </div>
        <div class="actions" style="display: flex; justify-content: center;">
            <button class="ui button primary" id="applyButton">Apply</button>
        </div>
    </div>

    <div class="ui mini modal" id="fileActionModal">
        <i class="close icon"></i>
        <div class="header" id="fileActionModalLabel">
            File Actions
            <br>
            <h4 style="text-align: center;">What would you like to do with the uploaded file?</h4>
        </div>
        <div class="ui" style="display: flex; justify-content: space-evenly; margin:20px">
            <button id="readFileBtn" class="ui circular icon button primary rounded roundButtons">Read File</button>
            <button id="summarizeFileBtn" class="ui circular icon button teal rounded roundButtons">Summarize
                Text</button>
        </div>
    </div>

    <div id="translate-modal" class="ui mini modal">
        <i class="close icon"></i>
        <div class="header">Translate Text</div>
        <div class="content">
            <div class="ui form">
                <div class="field">
                    <label>Text</label>
                    <textarea id="translate-text-input"></textarea>
                </div>
                <div class="mic-button-wrapper">
                    <button id="mic-button1" class="mic-button1">
                        <i class="microphone icon"></i>
                    </button>
                </div>
                <div class="field">
                    <label>Source Language</label>
                    <select id="translate-source-language" class="ui search dropdown">
                        <option value="" disabled selected>Select Language</option>
                    </select>
                </div>
                <div class="field">
                    <label>Target Language</label>
                    <select id="translate-target-language" class="ui search dropdown">
                        <option value="" disabled selected>Select Language</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="actions">
            <div class="ui button" id="translate-cancel-btn">Cancel</div>
            <div class="ui primary button" id="translate-submit-btn">Submit</div>
        </div>
    </div>

    <div id="leave-modal" class="ui mini modal">
        <i class="close icon"></i>
        <div class="header">Apply for Leave</div>
        <div class="content">
            <div class="ui form">
                <div class="field">
                    <label>Start Date</label>
                    <input type="date" id="leave-start-date">
                </div>
                <div class="field">
                    <label>End Date</label>
                    <input type="date" id="leave-end-date">
                </div>
                <div class="field">
                    <label>Reason</label>
                    <textarea id="leave-reason"></textarea>
                </div>
            </div>
        </div>
        <div class="actions">
            <div id="leave-cancel" class="ui button">Cancel</div>
            <div id="leave-submit" class="ui button primary">Submit</div>
        </div>
    </div>

    <!-- Overtime Modal -->
    <div id="overtime-modal" class="ui mini modal">
        <i class="close icon"></i>
        <div class="header">Apply for Overtime</div>
        <div class="content">
            <div class="ui form">
                <div class="field">
                    <label>Duration (in hours)</label>
                    <input type="number" id="overtime-duration" max="3">
                </div>
                <div class="field">
                    <label>Reason</label>
                    <textarea id="overtime-reason"></textarea>
                </div>
            </div>
        </div>
        <div class="actions">
            <div id="overtime-cancel" class="ui button">Cancel</div>
            <div id="overtime-submit" class="ui button primary">Submit</div>
        </div>
    </div>

    <!-- Early Leaving Modal -->
    <div id="early-modal" class="ui mini modal">
        <i class="close icon"></i>
        <div class="header">Apply for Early Leaving</div>
        <div class="content">
            <div class="ui form">
                <div class="field">
                    <label>Date</label>
                    <input type="date" id="early-date">
                </div>
                <div class="field">
                    <label>Reason</label>
                    <textarea id="early-reason"></textarea>
                </div>
            </div>
        </div>
        <div class="actions">
            <div id="early-cancel" class="ui button">Cancel</div>
            <div id="early-submit" class="ui button primary">Submit</div>
        </div>
    </div>

    <div id="container">
        <h1>Voice Assistant VERA</h1>
        <button id="mic-button"><i class="fas fa-microphone"></i></button>
        <p id="transcript"></p>
        <p id="translated-text1"></p>
        <p id="translated-text"></p>
        <div id="listening">
            <svg width="50" height="50" onclick='clicked();' class='w3-card 
                   w3-hover-shadow'>
                <polyline id='line' />
                <polyline id='line2' />
                <polyline id='line3' />
            </svg>
        </div>
        <div id="text-input-container">
            <textarea id="text-input" rows="4" placeholder="Type the text you want me to read..."></textarea><br>
            <button id="submit-button">Submit</button>
        </div>
        <div id="image-upload-container">
            <label id="image-upload-label" for="image-upload">Select Image to Analyze:</label><br>
            <input type="file" id="image-upload" accept="image/*">
            <img id="image-preview" src="" alt="Image Preview">
            <div class="loader" id="loader1"></div>
            <p id="upload-confirmation"></p>
        </div>
        <div id="responseContainer" style="width: 400px; height: 200px; overflow-y: scroll; display: none">
        </div>
        <div id="file-upload-container">
            <label id="file-upload-label" for="file-upload">
                Select File to Read:
                <span class="file-upload-info">(PDF, TXT, DOC, DOCX)</span>
            </label>
            <br>
            <input type="file" id="file-upload" accept=".pdf, .txt, .doc, .docx">
            <div class="loader" id="loader2"></div>
        </div>
        <div id="apply-action-container" class="hidden">
            <div class="header">
                <br>
                <h4 style="text-align: center;">What would you like to apply?</h4>
            </div>
            <div class="ui" style="display: flex; justify-content: space-evenly; margin:20px">
                <button id="leavebtn" class="ui circular icon button primary rounded roundButtons">For Leave</button>
                <button id="overtimebtn" class="ui circular icon button teal rounded roundButtons">For OverTime</button>
                <button id="earlybtn" class="ui circular icon button olive rounded roundButtons">For Early
                    Leaving</button>
            </div>
        </div>
        <div id="suggested-commands">
            <p>Try saying:</p>
            <ul>
                <li>Tell me something about Cricket</li>
                <li>Analyze the image</li>
                <li>Read the file</li>
                <li>Translate</li>
            </ul>
        </div>
        <audio id="audioElement" style="display: none;">
            <source id="audioSource" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
        <div id="bars">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
    </div>

    <script>
        let currentAudioIndex = 0;
        const audioElement = document.getElementById('audioElement');
        const audioSource = document.getElementById('audioSource');
        const barsContainer = document.getElementById('bars');

        function fetchAndPlayAudio() {
            fetch(`/play_audio/${currentAudioIndex}`)
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        throw new Error('Audio not found');
                    }
                })
                .then(blob => {
                    const audioUrl = URL.createObjectURL(blob);
                    audioSource.src = audioUrl;
                    audioElement.load();
                    audioElement.play();
                    showBars();
                    currentAudioIndex++;
                })
                .catch(error => console.error(error));
        }

        // Function to periodically fetch and play audio
        function startAutoFetch() {
            setInterval(fetchAndPlayAudio, 2000); // Adjust interval as needed (e.g., every 2 seconds)
        }

        // Start auto fetching on page load
        window.onload = function () {
            fetch('/reset_index', { method: 'POST' }); // Reset index initially
            startAutoFetch(); // Start automatic fetching
        };

        audioElement.addEventListener('ended', () => {
            hideBars(); // Hide bars when audio ends
        });

        function showBars() {
            barsContainer.style.display = 'flex'; // Show bars container
            animateBars(); // Start animation
        }

        function hideBars() {
            barsContainer.style.display = 'none'; // Hide bars container
            stopAnimation(); // Stop animation
        }

        function animateBars() {
            const bars = barsContainer.querySelectorAll('.bar');
            bars.forEach((bar, index) => {
                bar.style.animationDelay = `-${index * 100}ms`;
                bar.style.animationPlayState = 'running';
            });
        }

        function stopAnimation() {
            const bars = barsContainer.querySelectorAll('.bar');
            bars.forEach(bar => {
                bar.style.animationPlayState = 'paused';
            });
        }




    </script>
    <script>
        function specialAction_UpDown() {
            let clr = 'lightyellow';
            updateBackground(clr);
        }

        function specialAction_LeftRight() {
            let clr = 'lightblue';
            updateBackground(clr);
        }

        function specialAction_ClockWise() {
            let clr = 'lightgreen';
            updateBackground(clr);
        }

        function updateBackground(colour) {
            document.body.style.background = colour;
        }

        // ----------------------------

        ///////// RESPONSIVE ANIMATION:

        const wsvg = 50;
        const hsvg = 50;
        const offsetx = 0;
        const offsety = hsvg / 2;
        let shiftx = 0;
        let shifty = hsvg / 2;
        let points = '';
        let points2 = '';
        let points3 = '';
        let x, y, y2, y3;
        if (typeof timer === 'undefined') {
            let timer;
        }
        let temporary;
        const slowInterval = 40;
        const fastInterval = 10;
        let interval = slowInterval;

        addPoints();
        showLine();
        animate();

        function addPoint(x, y) {
            points += ' ' + (x + offsetx) + ',' + (y + offsety);
        }
        function addPoint2(x, y) {
            points2 += ' ' + (x + offsetx) + ',' + (y + offsety);
        }
        function addPoint3(x, y) {
            points3 += ' ' + (x + offsetx) + ',' + (y + offsety);
        }
        function addPoints() {
            // set up x range
            x = createX(0, wsvg, 1);
            // actually add the points
            for (i in x) {
                y = hsvg / 5 * Math.sin(x[i] * 4 / wsvg - shiftx) * Math.sqrt(1 - Math.pow((x[i] - wsvg / 2) * 2 / wsvg, 2));
                addPoint(x[i], y);
                y2 = hsvg / 5 * Math.sin(x[i] * 4 / wsvg - shiftx / 2) * Math.sqrt(1 - Math.pow((x[i] - wsvg / 2) * 2 / wsvg, 2));
                addPoint2(x[i], y2);
                y3 = hsvg / 4 * Math.sin(x[i] * 10 / wsvg - shiftx) * Math.sqrt(1 - Math.pow((x[i] - wsvg / 2) * 2 / wsvg, 2));
                addPoint3(x[i], y3);
            }
        }
        function createX(start, end, interval) {
            let xv = [];
            for (let i = start; i <= end; i += interval) {
                xv.push(i);
            }
            return xv;
        }

        function showLine() {
            document.getElementById('line').setAttribute('points', points);
            document.getElementById('line2').setAttribute('points', points2);
            document.getElementById('line3').setAttribute('points', points3);
        }

        function animate() {
            timer = setInterval(animateFunction, interval);
        }
        function animateFunction() {
            points = '';
            points2 = '';
            points3 = '';
            shiftx += 0.1;
            addPoints();
            showLine();
        }
        function clicked() {
            setUp_webkitSpeechRecognition();
            toggleStart_webkitSpeechRecognition();
            // reset timer with fast interval
            clearInterval(timer);
            timer = setInterval(animateFunction, fastInterval);
            // reset timer with slow interval
            let resetAfter = 1000;
            temporary = setTimeout(temporaryChange, resetAfter);
        }
        function temporaryChange() {
            clearInterval(timer);
            timer = setInterval(animateFunction, slowInterval);
        }

        // -------------------------

        window.mobilecheck = function () {
            var check = false;
            (function (a) { if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };

        var isMobile = window.mobilecheck();
        if (isMobile) {
            $('#use-laptop').text('Wait for the beep. For faster voice recognition, use a laptop.');
            $('#use-laptop').css({ color: 'lightgrey', background: 'darkgreen' });
        }
    </script>
    <script>
        $(document).ready(function () {
            $('#voiceModal').modal({
                closable: false
            }).modal('show');

            $('#Speechrate').hide();

            $('#male').click(function () {
                setVoicePreference('male');
            });

            $('#female').click(function () {
                setVoicePreference('female');
            });

            $('#speechRateSlider').on('input', function () {
                let rate = $(this).val();
                $('#speechRateValue').text(rate);
                setSpeechRate(rate);
            });

            $('#applyButton').click(function () {
                $('#voiceModal').modal('hide');
            });

            function setVoicePreference(voice) {
                if (voice == 'male') {
                    $('#Speechrate').show();
                }
                if (voice == 'female') {
                    $('#Speechrate').hide();
                }
                $.ajax({
                    url: '/set-voice-preference',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ voice: voice }),
                    success: function () {
                        console.log('Voice preference set to ' + voice);
                    }
                });
            }

            function setSpeechRate(rate) {
                $.ajax({
                    url: '/set_speech_rate',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ rate: parseInt(rate) }),
                    success: function (response) {
                        console.log('Speech rate set to ' + response.rate);
                    }
                });
            }
        });
    </script>
    <script>
        const micButton = document.getElementById("mic-button");
        const transcriptElement = document.getElementById("transcript");
        const listeningElement = document.getElementById("listening");
        const textInputContainer = document.getElementById("text-input-container");
        const textInput = document.getElementById("text-input");
        const submitButton = document.getElementById("submit-button");
        const imageUploadContainer = document.getElementById("image-upload-container");
        const imageUploadLabel = document.getElementById("image-upload-label");
        const imageUpload = document.getElementById("image-upload");
        const imagePreview = document.getElementById("image-preview");
        const loader1 = document.getElementById('loader1');
        const loader2 = document.getElementById('loader2');
        const uploadConfirmation = document.getElementById("upload-confirmation");
        const fileUploadContainer = document.getElementById("file-upload-container");
        const fileUploadLabel = document.getElementById("file-upload-label");
        const fileUpload = document.getElementById("file-upload");
        const fileActionModal = document.getElementById('fileActionModal');
        const readFileBtn = document.getElementById('readFileBtn');
        const summarizeFileBtn = document.getElementById('summarizeFileBtn');
        const applyContainer = document.getElementById("apply-action-container");
        const leaveButton = document.getElementById("leavebtn");
        const overtimeButton = document.getElementById("overtimebtn");
        const earlyButton = document.getElementById("earlybtn");
        const TranslateElement = document.getElementById("translated-text");
        const TranslateElement2 = document.getElementById("translated-text1");
        const responseContainer = document.getElementById('responseContainer');
        const suggestedCommands = document.getElementById("suggested-commands");

        let imageCommand = ""; // To store the command related to image processing

        micButton.addEventListener("click", () => {
            audioElement.pause();
            audioElement.currentTime = 0;
            hideBars();
            resetUI();
            listeningElement.style.display = "block";
            suggestedCommands.style.display = "none";

            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                transcriptElement.textContent = "You: " + transcript;
                listeningElement.style.display = "none";
                suggestedCommands.style.display = "none";

                if (transcript.toLowerCase().includes("read this")) {
                    textInputContainer.style.display = "block";
                } else if (transcript.toLowerCase().includes("analyze the image") || transcript.toLowerCase().includes("analyse the image")) {
                    imageUploadLabel.style.display = "inline-block"; // Show the select image label
                    imageUploadContainer.style.display = "inline-block"; // Show the image upload container
                    imageCommand = "analyze the image"; // Set the command for analyzing the image
                    imageUpload.click();
                } else if (transcript.toLowerCase().includes("read the image")) {
                    imageUploadLabel.style.display = "inline-block"; // Show the select image label
                    imageUploadContainer.style.display = "inline-block"; // Show the image upload container
                    imageCommand = "read the image"; // Set the command for reading the image
                    imageUpload.click();
                } else if (transcript.toLowerCase().includes("file")) {
                    fileUploadLabel.style.display = "inline-block"; // Show the select image label
                    fileUploadContainer.style.display = "inline-block"; // Show the image upload container
                    fileUpload.click();
                } else if (transcript.toLowerCase().includes("apply for leave")) {
                    applyContainer.classList.remove("hidden");
                } else if (transcript.toLowerCase().includes("translate")) {
                    $('#translate-modal').modal('show');
                } else {
                    fetch("/voice-command", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ command: transcript })
                    })
                        .then(response => response.json())
                        .then(data => {
                            const responseText = data.response;
                            transcriptElement.textContent = ""; // Clear previous response
                            transcriptElement.textContent += "Assistant: " + responseText;
                        });
                }
            };

            recognition.onerror = (event) => {
                console.error(event.error);
                listeningElement.style.display = "none";
            };
        });
        suggestedCommands.style.display = "block";

        function resetUI() {
            fileUpload.value = '';
            textInputContainer.style.display = "none";
            imageUploadLabel.style.display = "none";
            imageUploadContainer.style.display = "none";
            imagePreview.style.display = "none";
            uploadConfirmation.style.display = "none";
            fileUploadLabel.style.display = "none";
            fileUploadContainer.style.display = "none";
            transcriptElement.textContent = "";
            TranslateElement.textContent = "";
            TranslateElement2.textContent = "";
            responseContainer.style.display = "none";
        }

        imageUpload.addEventListener("change", () => {
            const file = imageUpload.files[0];
            if (file) {
                const formData = new FormData();
                formData.append("image", file);
                formData.append("command", imageCommand); // Include the command in the form data

                loader1.style.display = "block"; // Show the loader

                fetch("/upload-image", {
                    method: "POST",
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        const responseText = data.response;
                        transcriptElement.textContent = ""; // Clear previous response
                        transcriptElement.textContent += "Assistant: " + responseText;
                        loader1.style.display = "none"; // Hide the loader
                        uploadConfirmation.style.display = "block"; // Show the confirmation message
                        imagePreview.src = URL.createObjectURL(file); // Show image preview
                        imagePreview.style.display = "block";
                        Swal.fire({
                            icon: 'success',
                            title: 'Image Uploaded',
                            text: 'Image uploaded successfully!',
                            timer: 1500,
                            showConfirmButton: false
                        });
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        loader1.style.display = "none"; // Hide the loader
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!',
                        });
                    });
            }
        });

        function callTextCommand(fileText) {
            fetch('/text-command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: fileText })
            })
                .then(response => response.json())
                .then(data => {
                    const responseText = data.response;
                    console.log('API Response:', responseText);
                })
                .catch(error => {
                    console.error('Error calling API:', error);
                });
        }

        // Function to append response to the response container
        function appendResponse(responseText) {
            const responseContainer = document.getElementById('responseContainer');
            const responseElement = document.createElement('p');
            responseElement.textContent = responseText;
            responseContainer.appendChild(responseElement);

            responseContainer.style.display = "block";

            responseContainer.scrollTop = responseContainer.scrollHeight;
        }

        // Function to handle file upload
        fileUpload.addEventListener('change', () => {
            const file = fileUpload.files[0];
            const allowedExtensions = ['txt', 'docx', 'doc', 'pdf']; // Add your allowed extensions here
            const fileExtension = file.name.split('.').pop().toLowerCase();
            if (!allowedExtensions.includes(fileExtension)) {
                Swal.fire({
                    icon: 'error',
                    title: 'Unsupported File Type',
                    text: 'Please upload a file with one of the following extensions: ' + allowedExtensions.join(', '),
                    timer: 3000,
                    showConfirmButton: false
                });
            }
            else {
                if (file) {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('command', 'file'); // Include the command indicating file upload

                    loader2.style.display = 'block'; // Show the loader

                    fetch('/upload-file', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            transcriptElement.style.display = 'none';
                            const responseText = data.response;
                            loader2.style.display = 'none'; // Hide the loader

                            // Show the file action modal and handle the response
                            Swal.fire({
                                icon: 'success',
                                title: 'File Uploaded',
                                text: 'File uploaded successfully!',
                                timer: 1500,
                                showConfirmButton: false
                            }).then(() => {
                                $('#fileActionModal').modal('show');

                                $('#readFileBtn').click(() => {
                                    $('#fileActionModal').modal('hide');
                                    fileUploadLabel.style.display = "none";
                                    fileUploadContainer.style.display = "none";
                                    callTextCommand(responseText);
                                    appendResponse(responseText);
                                    fileUpload.value = '';
                                });

                                $('#summarizeFileBtn').click(() => {
                                    $('#fileActionModal').modal('hide');
                                    loader2.style.display = 'block';
                                    fetch('/summarize-text', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({ text: responseText }) // Replace responseText with actual file text
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            const summarizedText = data.summary;
                                            console.log('Summarized Text:', summarizedText);
                                            $('#summaryOutput').val(summarizedText); // Display summarized text in textarea
                                            loader2.style.display = 'none';
                                            appendResponse('Summarized Text: ' + summarizedText);
                                            fileUpload.value = '';
                                        })
                                        .catch(error => {
                                            console.error("Error:", error);
                                            loader2.style.display = 'none';
                                        });
                                });
                            });
                        })
                        .catch(error => {
                            console.error("Error:", error);
                            loader.style.display = 'none'; // Hide the loader
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: 'Something went wrong!',
                            });
                        });
                }
            }
        });


        submitButton.addEventListener("click", () => {
            const text = textInput.value;
            fetch("/text-command", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ text: text })
            })
                .then(response => response.json())
                .then(data => {
                    const responseText = data.response;
                    transcriptElement.textContent = "";
                    transcriptElement.textContent += "Assistant: " + responseText;
                    appendResponse('Assistant: ' + responseText)
                });
        });

        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            let month = today.getMonth() + 1;
            if (month < 10) {
                month = `0${month}`;
            }
            let day = today.getDate();
            if (day < 10) {
                day = `0${day}`;
            }
            return `${year}-${month}-${day}`;
        }

        // Event listeners for apply buttons
        leaveButton.addEventListener('click', () => {
            $('#leave-modal').modal('show');
        });

        overtimeButton.addEventListener('click', () => {
            $('#overtime-modal').modal('show');
        });

        earlyButton.addEventListener('click', () => {
            $('#early-modal').modal('show');
        });

        const leaveModal = $("#leave-modal");
        const leaveStartDateInput = document.getElementById("leave-start-date");
        const leaveEndDateInput = document.getElementById("leave-end-date");
        const leaveReasonInput = document.getElementById("leave-reason");
        const leaveCancelButton = document.getElementById("leave-cancel");
        const leaveSubmitButton = document.getElementById("leave-submit");

        leaveStartDateInput.min = getTodayDate();

        leaveStartDateInput.addEventListener("change", () => {
            leaveEndDateInput.min = leaveStartDateInput.value;

            if (leaveEndDateInput.value && leaveEndDateInput.value < leaveStartDateInput.value) {
                leaveEndDateInput.value = "";
            }
        });

        leaveCancelButton.addEventListener("click", () => {
            leaveModal.modal("hide");
            leaveStartDateInput.value = "";
            leaveEndDateInput.value = "";
            leaveReasonInput.value = "";
        });


        leaveSubmitButton.addEventListener("click", () => {
            const startDate = leaveStartDateInput.value;
            const endDate = leaveEndDateInput.value;
            const reason = leaveReasonInput.value;

            // Here you can add validation logic as per your requirements
            if (startDate && endDate && reason) {
                Swal.fire({
                    icon: "info",
                    title: "Leave Requested",
                    text: "Your leave request is under review.",
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    leaveModal.modal("hide");
                    leaveStartDateInput.value = "";
                    leaveEndDateInput.value = "";
                    leaveReasonInput.value = "";
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Incomplete Form",
                    text: "Please fill in all fields.",
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        });

        // Overtime modal setup
        const overtimeModal = $("#overtime-modal");
        const overtimeDurationInput = document.getElementById("overtime-duration");
        const overtimeReasonInput = document.getElementById("overtime-reason");
        const overtimeCancelButton = document.getElementById("overtime-cancel");
        const overtimeSubmitButton = document.getElementById("overtime-submit");

        overtimeCancelButton.addEventListener("click", () => {
            overtimeModal.modal("hide");
            overtimeDurationInput.value = "";
            overtimeReasonInput.value = "";
        });

        overtimeSubmitButton.addEventListener("click", () => {
            const duration = overtimeDurationInput.value;
            const reason = overtimeReasonInput.value;

            // Example validation for overtime duration
            if (duration && reason) {
                if (duration > 3) {
                    Swal.fire({
                        icon: "error",
                        title: "Invalid Duration",
                        text: "Overtime duration cannot exceed 3 hours.",
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: "info",
                        title: "Overtime Requested",
                        text: "Your overtime request is under review.",
                        timer: 2000,
                        showConfirmButton: false
                    }).then(() => {
                        overtimeModal.modal("hide");
                        overtimeDurationInput.value = "";
                        overtimeReasonInput.value = "";
                    });
                }
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Incomplete Form",
                    text: "Please fill in all fields.",
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        });

        // Early leaving modal setup
        const earlyModal = $("#early-modal");
        const earlyDateInput = document.getElementById("early-date");
        const earlyReasonInput = document.getElementById("early-reason");
        const earlyCancelButton = document.getElementById("early-cancel");
        const earlySubmitButton = document.getElementById("early-submit");

        earlyDateInput.min = getTodayDate();

        earlyCancelButton.addEventListener("click", () => {
            earlyModal.modal("hide");
            earlyDateInput.value = "";
            earlyReasonInput.value = "";
        });

        earlySubmitButton.addEventListener("click", () => {
            const date = earlyDateInput.value;
            const reason = earlyReasonInput.value;

            // Example validation for early leaving
            if (date && reason) {
                Swal.fire({
                    icon: "info",
                    title: "Early Leaving Requested",
                    text: "Your early leaving request is under review.",
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    earlyModal.modal("hide");
                    earlyDateInput.value = "";
                    earlyReasonInput.value = "";
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Incomplete Form",
                    text: "Please fill in all fields.",
                    timer: 2000,
                    showConfirmButton: false
                });
            }
        });
    </script>
    <script>
        const languages = {
            'af': 'Afrikaans',
            'sq': 'Albanian',
            'am': 'Amharic',
            'ar': 'Arabic',
            'hy': 'Armenian',
            'az': 'Azerbaijani',
            'eu': 'Basque',
            'be': 'Belarusian',
            'bn': 'Bengali',
            'bs': 'Bosnian',
            'bg': 'Bulgarian',
            'ca': 'Catalan',
            'ceb': 'Cebuano',
            'ny': 'Chichewa',
            'zh-cn': 'Chinese (Simplified)',
            'zh-tw': 'Chinese (Traditional)',
            'co': 'Corsican',
            'hr': 'Croatian',
            'cs': 'Czech',
            'da': 'Danish',
            'nl': 'Dutch',
            'en': 'English',
            'eo': 'Esperanto',
            'et': 'Estonian',
            'tl': 'Filipino',
            'fi': 'Finnish',
            'fr': 'French',
            'fy': 'Frisian',
            'gl': 'Galician',
            'ka': 'Georgian',
            'de': 'German',
            'el': 'Greek',
            'gu': 'Gujarati',
            'ht': 'Haitian Creole',
            'ha': 'Hausa',
            'haw': 'Hawaiian',
            'he': 'Hebrew',
            'hi': 'Hindi',
            'hmn': 'Hmong',
            'hu': 'Hungarian',
            'is': 'Icelandic',
            'ig': 'Igbo',
            'id': 'Indonesian',
            'ga': 'Irish',
            'it': 'Italian',
            'ja': 'Japanese',
            'jw': 'Javanese',
            'kn': 'Kannada',
            'kk': 'Kazakh',
            'km': 'Khmer',
            'ko': 'Korean',
            'ku': 'Kurdish (Kurmanji)',
            'ky': 'Kyrgyz',
            'lo': 'Lao',
            'la': 'Latin',
            'lv': 'Latvian',
            'lt': 'Lithuanian',
            'lb': 'Luxembourgish',
            'mk': 'Macedonian',
            'mg': 'Malagasy',
            'ms': 'Malay',
            'ml': 'Malayalam',
            'mt': 'Maltese',
            'mi': 'Maori',
            'mr': 'Marathi',
            'mn': 'Mongolian',
            'my': 'Myanmar (Burmese)',
            'ne': 'Nepali',
            'no': 'Norwegian',
            'ps': 'Pashto',
            'fa': 'Persian',
            'pl': 'Polish',
            'pt': 'Portuguese',
            'pa': 'Punjabi',
            'ro': 'Romanian',
            'ru': 'Russian',
            'sm': 'Samoan',
            'gd': 'Scots Gaelic',
            'sr': 'Serbian',
            'st': 'Sesotho',
            'sn': 'Shona',
            'sd': 'Sindhi',
            'si': 'Sinhala',
            'sk': 'Slovak',
            'sl': 'Slovenian',
            'so': 'Somali',
            'es': 'Spanish',
            'su': 'Sundanese',
            'sw': 'Swahili',
            'sv': 'Swedish',
            'tg': 'Tajik',
            'ta': 'Tamil',
            'te': 'Telugu',
            'th': 'Thai',
            'tr': 'Turkish',
            'uk': 'Ukrainian',
            'ur': 'Urdu',
            'uz': 'Uzbek',
            'vi': 'Vietnamese',
            'cy': 'Welsh',
            'xh': 'Xhosa',
            'yi': 'Yiddish',
            'yo': 'Yoruba',
            'zu': 'Zulu'
        };

        // Populate language dropdowns
        function populateLanguageDropdowns() {
            const sourceDropdown = $('#translate-source-language');
            const targetDropdown = $('#translate-target-language');

            sourceDropdown.append('<option value="" disabled selected>Select Language</option>');
            targetDropdown.append('<option value="" disabled selected>Select Language</option>');

            for (const [code, name] of Object.entries(languages)) {
                const option = `<option value="${code}">${name}</option>`;
                sourceDropdown.append(option);
                targetDropdown.append(option);
            }

            // Initialize Semantic UI dropdowns
            $('.ui.dropdown').dropdown();
        }

        $('#translate-submit-btn').click(() => {
            const text = $('#translate-text-input').val();
            const sourceLang = $('#translate-source-language').val();
            const targetLang = $('#translate-target-language').val();

            if (!text || !sourceLang || !targetLang) {
                alert("Please fill in all fields");
                return;
            }

            fetch('/translate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text, source_lang: sourceLang, target_lang: targetLang })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('Error: ' + data.error);
                    } else {
                        const translatedText = data.translated_text;
                        const transcriptText = data.Your_Text;
                        $('#translated-text1').text("Original: " + transcriptText);
                        $('#translated-text').text("\nTranslated: " + translatedText);
                        $('#translate-modal').modal('hide');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Translation failed. Please try again.');
                });
        });

        // Handle cancel button
        $('#translate-cancel-btn').click(() => {
            $('#translate-modal').modal('hide');
            $('#translate-text-input').val('');
            $('#translate-source-language').val('');
            $('#translate-target-language').val('');
        });

        // Initialize language dropdowns on page load
        $(document).ready(() => {
            populateLanguageDropdowns();

            // Speech recognition setup
            const micButtonModal = document.getElementById('mic-button1');
            const textInputModal = document.getElementById('translate-text-input');
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();

            micButtonModal.addEventListener('click', () => {
                recognition.start();
                micButtonModal.classList.toggle('active');
            });

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                textInputModal.value = transcript;
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                alert('Speech recognition error: ' + event.error);
            };
        });
    </script>
</body>

</html>